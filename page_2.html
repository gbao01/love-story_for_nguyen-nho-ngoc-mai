<!DOCTYPE html>
<html lang="vi">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>N·ª• c∆∞·ªùi em m·∫∑t tr·ªùi to·∫£ n·∫Øng</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Pacifico&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Tourney:ital,wght@0,100..900;1,100..900&display=swap" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            background: radial-gradient(#4c0c0c, #000);
            overflow: hidden;
            position: relative;
        }

        canvas {
            display: block;
        }

        /* Container ch·ª©a c√¢u h·ªèi v√† c√°c n√∫t */
        #questionContainer {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            text-align: center;
            padding: 20px;
            color: white;
            border-radius: 10px;
            width: 700px;
            height: auto;
            font-family: "Tourney", serif;
            font-optical-sizing: auto;
            font-weight: 400;
            font-style: normal;
            font-variation-settings: "wdth" 100;
            font-size: 40px;
            z-index: 2;
        }

        #questionText {
            margin-bottom: 20px;
            color: red;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.7);
        }

        .btn {
            margin: 5px;
            padding: 10px 20px;
            font-size: 16px;
            cursor: pointer;
            transition: background-color 0.3s;
            font-family: "Tourney", serif;
            font-optical-sizing: auto;
            font-weight: 400;
            font-style: normal;
            font-variation-settings: "wdth" 100;
            border: none;
            border-radius: 4px;
        }

        .no-btn {
            background-color: red;
            color: white;
            margin: 90px;
            cursor: none;
            transition: background 0.3s ease-in-out, color 0.3s ease-in-out;
            white-space: nowrap;
            display: none;
        }

        .yes-btn {
            white-space: nowrap;
            background-color: green;
            color: white;
            cursor: pointer;
            transition: background 0.3s ease-in-out, color 0.3s ease-in-out;
            display: none;
        }

        .yes-btn:hover {
            background: green;
        }

        .next-btn {
            background-color: transparent;
            color: white;
            margin-top: 30px;
            padding: 12px 30px;
            font-size: 20px;
            display: none; /* ·∫®n n√∫t Next ban ƒë·∫ßu */
        }
    </style>
</head>

<body>
    <audio id="myAudio" autoplay loop>
        <source src="./love.mp3" type="audio/mpeg">
    </audio>

    <canvas id="canvas"></canvas>

    <div id="questionContainer">
        <div id="questionText"></div>
        <button class="btn next-btn" id="nextButton">Ti·∫øp t·ª•c >>></button>
        <button class="btn yes-btn" id="yesButton">ƒê·ªìng √ù üíñ</button>
        <button class="btn no-btn" id="noButton" tabindex="-1">T·ª´ Ch·ªëi üíî</button>
    </div>

    <script>
        const canvas = document.getElementById('canvas');
        const ctx = canvas.getContext('2d');

        const questionText = document.getElementById('questionText');
        const nextButton = document.getElementById('nextButton');
        const yesButton = document.getElementById('yesButton');
        const noButton = document.getElementById('noButton');

        const story = [
            "Ch√†o em,... ",
            "C√≥ v√†i l·ªùi anh mu·ªën g·ª≠i t·ªõi em...",
            "Sau nh·ªØng l·∫ßn tr√≤ chuy·ªán, anh ƒë√£ th·∫•y m√¨nh h·ª£p nhau l·∫° k·ª≥... üí¨",
            "Nh·ªØng ƒë√™m th·ª©c khuya t√¢m s·ª±, c√πng nh·ªØng c√¢u chuy·ªán kh√¥ng ƒëi·ªÉm d·ª´ng... üåô",
            "Em xu·∫•t hi·ªán v√† n·ª• c∆∞·ªùi em l√† th·ª© khi·∫øn anh h·∫°nh ph√∫c nh·∫•t m·ªói ng√†y üòä",
            "Em c√≥ mu·ªën c√πng anh vi·∫øt ti·∫øp c√¢u chuy·ªán n√†y v√†o 14/02 n√†y kh√¥ng? üíå"
        ];

        let currentStoryIndex = 0;

        // ƒê·∫∑t k√≠ch th∆∞·ªõc canvas
        canvas.width = window.innerWidth;
        canvas.height = window.innerHeight;

        // H√†m v·∫Ω h√¨nh tr√°i tim
        function drawHeart(x, y, size, rotation) {
            ctx.save();
            ctx.translate(x, y);
            ctx.rotate(rotation);
            ctx.beginPath();
            ctx.moveTo(0, size / 10);

            // V·∫Ω ƒë∆∞·ªùng cong b√™n tr√°i
            ctx.bezierCurveTo(-size / 2, -size / 2, -size, size / 2, 0, size);

            // V·∫Ω ƒë∆∞·ªùng cong b√™n ph·∫£i
            ctx.bezierCurveTo(size, size / 2, size / 2, -size / 2, 0, size / 10);

            ctx.fillStyle = 'red';
            ctx.fill();
            ctx.closePath();
            ctx.restore();
        }

        // M·∫£ng ƒë·ªÉ l∆∞u tr·ªØ c√°c tr√°i tim
        const hearts = [];

        // H√†m t·∫°o tr√°i tim m·ªõi
        function createHeart() {
            const x = Math.random() * canvas.width;
            const y = -20; // B·∫Øt ƒë·∫ßu t·ª´ tr√™n c√πng
            const size = 5 + Math.random() * 10; // K√≠ch th∆∞·ªõc ng·∫´u nhi√™n
            const speed = 2 + Math.random() * 3; // T·ªëc ƒë·ªô r∆°i ng·∫´u nhi√™n
            const pathX = (Math.random() - 0.5) * 100; // Qu·ªπ ƒë·∫°o ngang
            const swingSpeed = (Math.random() - 0.5) * 0.05; // T·ªëc ƒë·ªô ƒëung ƒë∆∞a

            hearts.push({ x, y, size, speed, pathX, isAtBottom: false, stayTime: 0, rotation: 0, swingSpeed, isGoingUp: false });
        }

        // H√†m c·∫≠p nh·∫≠t v·ªã tr√≠ v√† v·∫Ω tr√°i tim
        function update() {
            ctx.clearRect(0, 0, canvas.width, canvas.height); // X√≥a canvas

            hearts.forEach((heart, index) => {
                if (!heart.isAtBottom) {
                    heart.y += heart.speed; // R∆°i xu·ªëng
                    heart.x += heart.pathX / 100; // Di chuy·ªÉn ngang
                    heart.rotation += heart.swingSpeed; // C·∫≠p nh·∫≠t g√≥c ƒëung ƒë∆∞a

                    // Ki·ªÉm tra n·∫øu tr√°i tim ƒë√£ ƒë·∫øn ƒë√°y m√†n h√¨nh
                    if (heart.y > canvas.height - heart.size) {
                        heart.isAtBottom = true; // ƒê√°nh d·∫•u l√† ƒë√£ ·ªü ƒë√°y
                    }
                } else if (heart.isGoingUp) {
                    heart.y -= heart.speed; // Bay l√™n
                    if (heart.y < -heart.size) {
                        hearts.splice(index, 1); // X√≥a tr√°i tim n·∫øu bay ra kh·ªèi m√†n h√¨nh
                    }
                } else {
                    // N·∫øu ƒë√£ ·ªü ƒë√°y, tƒÉng th·ªùi gian ·ªü l·∫°i
                    heart.stayTime += 1 / 60; // TƒÉng th·ªùi gian ·ªü l·∫°i (gi·∫£ s·ª≠ 60 FPS)
                    if (heart.stayTime > 10) { // N·∫øu ƒë√£ ·ªü l·∫°i 10 gi√¢y
                        hearts.splice(index, 1); // X√≥a tr√°i tim
                    }
                }
                // V·∫Ω tr√°i tim
                drawHeart(heart.x, heart.y, heart.size, heart.rotation);
            });

            requestAnimationFrame(update); // G·ªçi l·∫°i h√†m update
        }

        // T·∫°o tr√°i tim m·ªói n·ª≠a gi√¢y
        setInterval(createHeart, 100);

        // B·∫Øt ƒë·∫ßu c·∫≠p nh·∫≠t
        update();

        // H√†m hi·ªÉn th·ªã c√¢u chuy·ªán v·ªõi hi·ªáu ·ª©ng g√µ ch·ªØ
        function typeWriter(text, speed = 50) {
            return new Promise(resolve => {
                let i = 0;
                questionText.innerHTML = '';
                function type() {
                    if (i < text.length) {
                        questionText.innerHTML += text.charAt(i);
                        i++;
                        setTimeout(type, speed);
                    } else {
                        resolve();
                    }
                }
                type();
            });
        }

        // Hi·ªÉn th·ªã c√¢u chuy·ªán
        async function showStory() {
            await typeWriter(story[currentStoryIndex]);
            if (currentStoryIndex < story.length - 1) {
                nextButton.style.display = 'inline-block'; // Hi·ªÉn th·ªã n√∫t Next
            } else {
                nextButton.style.display = 'none'; // ·∫®n n√∫t Next ·ªü c√¢u cu·ªëi
                yesButton.style.display = 'inline-block'; // Hi·ªÉn th·ªã n√∫t Yes
                noButton.style.display = 'inline-block'; // Hi·ªÉn th·ªã n√∫t No
            }
        }

        // X·ª≠ l√Ω s·ª± ki·ªán khi nh·∫•n n√∫t "Next"
        nextButton.addEventListener('click', async function () {
            currentStoryIndex++;
            nextButton.style.display = 'none'; // ·∫®n n√∫t Next ngay khi nh·∫•n
            await showStory();
        });

        // B·∫Øt ƒë·∫ßu hi·ªÉn th·ªã c√¢u chuy·ªán
        showStory();

        // X·ª≠ l√Ω s·ª± ki·ªán khi nh·∫•n n√∫t "No"
        document.getElementById('noButton').addEventListener('click', function () {
            const questionContainer = document.getElementById('questionContainer');
            questionContainer.style.position = 'absolute';
            questionContainer.style.top = `${Math.random() * 90}%`;
            questionContainer.style.left = `${Math.random() * 90}%`;
            questionContainer.style.pointerEvents = 'none'; // T·∫Øt kh·∫£ nƒÉng t∆∞∆°ng t√°c
        });

        // X·ª≠ l√Ω s·ª± ki·ªán khi chu·ªôt ch·∫°m v√†o n√∫t "No"
        document.getElementById('noButton').addEventListener('mouseenter', function () {
            const button = document.getElementById('noButton');
            let newTop, newLeft;
            do {
                newTop = Math.random() * 90;
                newLeft = Math.random() * 90;
            } while (isOverlapping(newTop, newLeft)); // Ki·ªÉm tra tr√πng l·∫∑p v·ªõi n√∫t "Yes"
            button.style.position = 'absolute';
            button.style.top = `${newTop}%`;
            button.style.left = `${newLeft}%`;
        });

        // H√†m ki·ªÉm tra xem hai n√∫t c√≥ tr√πng l·∫∑p kh√¥ng
        function isOverlapping(newTop, newLeft) {
            const yesButton = document.getElementById('yesButton');
            const yesRect = yesButton.getBoundingClientRect();
            const noRect = {
                top: newTop * window.innerHeight / 100,
                left: newLeft * window.innerWidth / 100,
                width: yesRect.width,
                height: yesRect.height
            };

            return !(
                noRect.left > yesRect.right ||
                noRect.left + noRect.width < yesRect.left ||
                noRect.top > yesRect.bottom ||
                noRect.top + noRect.height < yesRect.top
            );
        }

        // H√†m ki·ªÉm tra kho·∫£ng c√°ch gi·ªØa con tr·ªè chu·ªôt v√† n√∫t "No"
        function checkMouseProximity(event) {
            const button = document.getElementById('noButton');
            const buttonRect = button.getBoundingClientRect();

            // T√≠nh to√°n v·ªã tr√≠ trung t√¢m c·ªßa n√∫t "No"
            const buttonCenterX = buttonRect.left + buttonRect.width / 2;
            const buttonCenterY = buttonRect.top + buttonRect.height / 2;

            // T√≠nh kho·∫£ng c√°ch gi·ªØa con tr·ªè chu·ªôt v√† trung t√¢m n√∫t "No"
            const distance = Math.sqrt(
                Math.pow(event.clientX - buttonCenterX, 2) +
                Math.pow(event.clientY - buttonCenterY, 2)
            );

            // N·∫øu kho·∫£ng c√°ch nh·ªè h∆°n 20px, di chuy·ªÉn n√∫t "No"
            if (distance < 60) {
                let newTop, newLeft;
                do {
                    newTop = Math.random() * 90; // V·ªã tr√≠ ng·∫´u nhi√™n theo chi·ªÅu d·ªçc
                    newLeft = Math.random() * 90; // V·ªã tr√≠ ng·∫´u nhi√™n theo chi·ªÅu ngang
                } while (isOverlapping(newTop, newLeft)); // Ki·ªÉm tra tr√πng l·∫∑p v·ªõi n√∫t "Yes"

                button.style.position = 'absolute';
                button.style.top = `${newTop}%`;
                button.style.left = `${newLeft}%`;
            }
        }

        // Th√™m s·ª± ki·ªán mousemove ƒë·ªÉ ki·ªÉm tra kho·∫£ng c√°ch
        document.addEventListener('mousemove', checkMouseProximity);

        // X·ª≠ l√Ω s·ª± ki·ªán khi nh·∫•n n√∫t "Yes"
        yesButton.addEventListener('click', function () {
            noButton.style.display = 'none';
            yesButton.style.display = 'none';
            newtext = "C·∫£m ∆°n em! Mong r·∫±ng ƒë√¢y s·∫Ω l√† kh·ªüi ƒë·∫ßu ƒë·∫πp nh·∫•t m√† anh c√≥ th·ªÉ danh cho em üíû"; // Thay ƒë·ªïi n·ªôi dung

            // B·∫Øt ƒë·∫ßu hi·ªáu ·ª©ng g√µ ch·ªØ cho ƒëo·∫°n vƒÉn m·ªõi
            requestAnimationFrame((timestamp) => typeWriter(newtext));
            hearts.forEach(heart => {
                heart.isGoingUp = true; // ƒê√°nh d·∫•u tr√°i tim ƒë·ªÉ bay l√™n
            });
        });
    </script>
</body>

</html>
